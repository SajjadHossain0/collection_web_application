<!--Authenticated user-->
<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <section th:insert="~{base :: header}"></section>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<section th:insert="~{base :: navbar}"></section>

<!--Addd to collection button-->
<div class="container" style="text-align: center">
    <div class="d-grid gap-2" style="margin-top: 15px">
        <button th:text="#{lang.addbtn}" type="button" class="btn btn-dark" data-bs-toggle="modal"
                data-bs-target="#addCollectionModal">Add new collection
        </button>
    </div>
</div>

<!-- Modal for add new collections -->
<div class="modal fade" id="addCollectionModal" tabindex="-1" aria-labelledby="addCollectionModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCollectionModalLabel" th:text="#{lang.addbtn}">Add New Collection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" th:action="@{/user/add_collection}" enctype="multipart/form-data">
                    <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>

                    <div class="mb-3">
                        <label for="title" class="form-label" th:text="#{lang.addtitle}">Title</label>
                        <input type="text" class="form-control" id="title" name="title"
                               maxlength="20" oninput="updateCharacterCount()" required>
                        <small id="charCountTitle" class="form-text text-muted">20 characters remaining.</small>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label" th:text="#{lang.adddescription}">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="4"
                                  placeholder="Enter a detailed description..."
                                  maxlength="150" required
                                  oninput="updateCharacterCount()"></textarea>
                        <small id="charCountDescription" class="form-text text-muted">150 characters remaining.</small>
                    </div>

                    <!-- Custom Fields -->
                    <div class="border p-3 mb-3">
                        <h6>Custom Fields</h6>
                        <p class="text-muted small mb-3">Enable and set the field names for custom attributes of your
                            collection.</p>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string1_state"
                                           id="custom_string1">
                                    <label class="form-check-label" for="custom_string1">Custom String 1</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string1_name"
                                       placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int1_state"
                                           id="custom_int1">
                                    <label class="form-check-label" for="custom_int1">Custom Integer 1</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int1_name"
                                       placeholder="Field Name">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string2_state"
                                           id="custom_string2">
                                    <label class="form-check-label" for="custom_string2">Custom String 2</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string2_name"
                                       placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int2_state"
                                           id="custom_int2">
                                    <label class="form-check-label" for="custom_int2">Custom Integer 2</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int2_name"
                                       placeholder="Field Name">
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string3_state"
                                           id="custom_string3">
                                    <label class="form-check-label" for="custom_string3">Custom String 3</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string3_name"
                                       placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int3_state"
                                           id="custom_int3">
                                    <label class="form-check-label" for="custom_int3">Custom Integer 3</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int3_name"
                                       placeholder="Field Name">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-dark w-100" th:text="#{lang.addcollection}">Add Collection
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>


<!--
<div class="modal fade" id="editCollectionModal" tabindex="-1" aria-labelledby="editCollectionModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCollectionModalLabel" th:text="#{lang.addbtn}">Edit
                    Collection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" th:action="@{/user/edit_collection}" enctype="multipart/form-data">
                    <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>

                    <div class="mb-3">
                        <label for="title" class="form-label" th:text="#{lang.addtitle}">Title</label>
                        <input type="text" class="form-control" id="editTitle" name="title"
                               maxlength="20" oninput="updateEditCharacterCount()" required>
                        <small id="editCharCountTitle" class="form-text text-muted">20 characters remaining.</small>
                    </div>

                    <div class="mb-3">
                        <label for="editDescription" class="form-label" th:text="#{lang.adddescription}">Description</label>
                        <textarea class="form-control" id="editDescription" name="description" rows="4"
                                  placeholder="Enter a detailed description..."
                                  maxlength="150" required
                                  oninput="updateEditCharacterCount()"></textarea>
                        <small id="editCharCountDescription" class="form-text text-muted">150 characters remaining.</small>
                    </div>

                    &lt;!&ndash; Custom Fields &ndash;&gt;
                    <div class="border p-3 mb-3">
                        <h6>Custom Fields</h6>
                        <p class="text-muted small mb-3">Enable and set the field names for custom attributes of your
                            collection.</p>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string1_state"
                                           id="edit_custom_string1">
                                    <label class="form-check-label" for="edit_custom_string1">Custom String 1</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string1_name"
                                       placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int1_state"
                                           id="edit_custom_int1">
                                    <label class="form-check-label" for="edit_custom_int1">Custom Integer 1</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int1_name"
                                       placeholder="Field Name">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string2_state"
                                           id="edit_custom_string2">
                                    <label class="form-check-label" for="edit_custom_string2">Custom String 2</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string2_name"
                                       placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int2_state"
                                           id="edit_custom_int2">
                                    <label class="form-check-label" for="edit_custom_int2">Custom Integer 2</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int2_name"
                                       placeholder="Field Name">
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string3_state"
                                           id="edit_custom_string3">
                                    <label class="form-check-label" for="edit_custom_string3">Custom String 3</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string3_name"
                                       placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int3_state"
                                           id="edit_custom_int3">
                                    <label class="form-check-label" for="edit_custom_int3">Custom Integer 3</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int3_name"
                                       placeholder="Field Name">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-dark w-100" th:text="#{lang.addcollection}">Add Collection
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
-->


<!-- Modal for edit collections -->
<div class="modal fade" id="editCollectionModal" tabindex="-1" aria-labelledby="editCollectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCollectionModalLabel" th:text="#{lang.editcollection}">Edit Collection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" th:action="@{/user/edit_collection}" enctype="multipart/form-data">
                    <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
                    <input type="hidden" id="editCollectionId" name="id"/>

                    <div class="mb-3">
                        <label for="editTitle" class="form-label" th:text="#{lang.addtitle}">Title</label>
                        <input type="text" class="form-control" id="editTitle" name="title"
                               maxlength="20" oninput="updateEditCharacterCount()" required>
                        <small id="editCharCountTitle" class="form-text text-muted">20 characters remaining.</small>
                    </div>

                    <div class="mb-3">
                        <label for="editDescription" class="form-label" th:text="#{lang.adddescription}">Description</label>
                        <textarea class="form-control" id="editDescription" name="description" rows="4"
                                  maxlength="150" oninput="updateEditCharacterCount()" required></textarea>
                        <small id="editCharCountDescription" class="form-text text-muted">150 characters remaining.</small>
                    </div>

                    <!-- Custom Fields -->
                    <div class="border p-3 mb-3">
                        <h6>Custom Fields</h6>
                        <p class="text-muted small mb-3">Enable and set the field names for custom attributes of your collection.</p>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string1_state" id="edit_custom_string1">
                                    <label class="form-check-label" for="edit_custom_string1">Custom String 1</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string1_name" placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int1_state" id="edit_custom_int1">
                                    <label class="form-check-label" for="edit_custom_int1">Custom Integer 1</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int1_name" placeholder="Field Name">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string2_state" id="edit_custom_string2">
                                    <label class="form-check-label" for="edit_custom_string2">Custom String 2</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string2_name" placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int2_state" id="edit_custom_int2">
                                    <label class="form-check-label" for="edit_custom_int2">Custom Integer 2</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int2_name" placeholder="Field Name">
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_string3_state" id="edit_custom_string3">
                                    <label class="form-check-label" for="edit_custom_string3">Custom String 3</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_string3_name" placeholder="Field Name">
                            </div>

                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="custom_int3_state" id="edit_custom_int3">
                                    <label class="form-check-label" for="edit_custom_int3">Custom Integer 3</label>
                                </div>
                                <input type="text" class="form-control mt-2" name="custom_int3_name" placeholder="Field Name">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-dark w-100" th:text="#{lang.editbtn}">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>








<!--card view for shows all the collections-->
<div class="container">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

        <!-- Iterate over the collections -->
        <div class="col" style="padding: 10px" th:each="collection : ${userCollection}">

            <div id="main-card" class="card" style="width: 100%;">
                <!--Top Edit & delete buttons-->
                <div class="d-flex justify-content-end p-2" style="margin: 5px">
                    <button id="edit-btn" style="margin: 2px" class="btn btn-outline-secondary"
                            th:data-id="${collection.id}" th:data-title="${collection.title}"
                            th:data-description="${collection.description}" data-bs-toggle="modal"
                            data-bs-target="#editCollectionModal"
                            th:text="#{lang.editbutton}">Edit
                    </button>
                    <button id="deleteBtn" class="btn btn-outline-danger"
                            th:onclick="'deleteCollection(' + ${collection.id} + ')'"
                            th:text="#{lang.deletebutton}">Delete
                    </button>

                </div>
                <!--=========================-->

                <!--middle side by side info & image option-->
                <div class="d-flex">
                    <div id="text-div" class="w-50 p-2">
                        <div>
                            <h5 th:text="#{lang.addtitle}">Title</h5>
                            <p th:text="${collection.title}"></p>
                        </div>
                        <div>
                            <h5 th:text="#{lang.adddescription}">Description</h5>
                            <p th:text="${collection.description}"></p>
                        </div>
                    </div>
                </div>
                <!--============================-->

                <!-- Down date & See Collection button -->
                <div class="d-flex justify-content-between p-2">
                    <div>
                        <p class="mb-0" th:text="${collection.collection_creation_date}"></p>
                    </div>
                    <div>
                        <a th:href="@{/user/myCollection/item(id=${collection.id})}"
                           class="btn btn-outline-info"
                           th:text="#{lang.seecollection}">See Collection</a>
                    </div>
                </div>
                <!-- ============================ -->

            </div>

        </div>
        <!-- End of iteration -->
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const editButtons = document.querySelectorAll('#edit-btn');
        const editTitle = document.getElementById('editTitle');
        const editDescription = document.getElementById('editDescription');
        const editCollectionId = document.getElementById('editCollectionId');

        editButtons.forEach(button => {
            button.addEventListener('click', function () {
                const collectionId = this.getAttribute('data-id');
                const collectionTitle = this.getAttribute('data-title');
                const collectionDescription = this.getAttribute('data-description');

                editTitle.value = collectionTitle;
                editDescription.value = collectionDescription;
                editCollectionId.value = collectionId;

                // Update character counts
                updateEditCharacterCount();
            });
        });
    });

    function updateEditCharacterCount() {
        const editTitletextarea = document.getElementById('editTitle');
        const editTitlecharCount = document.getElementById('editCharCountTitle');
        const editTitlemaxLength = editTitletextarea.getAttribute('maxlength');
        const editTitlecurrentLength = editTitletextarea.value.length;
        editTitlecharCount.textContent = `${editTitlemaxLength - editTitlecurrentLength} characters remaining.`;

        const editDescriptiontextarea = document.getElementById('editDescription');
        const editDescriptioncharCount = document.getElementById('editCharCountDescription');
        const editDescriptionmaxLength = editDescriptiontextarea.getAttribute('maxlength');
        const editDescriptioncurrentLength = editDescriptiontextarea.value.length;
        editDescriptioncharCount.textContent = `${editDescriptionmaxLength - editDescriptioncurrentLength} characters remaining.`;
    }

    function updateCharacterCount() {
        // for title input
        const title_textarea = document.getElementById('title');
        const title_charCount = document.getElementById('charCountTitle');
        const title_maxLength = title_textarea.getAttribute('maxlength');
        const title_currentLength = title_textarea.value.length;
        title_charCount.textContent = `${title_maxLength - title_currentLength} characters remaining.`;

        // for description input
        const description_textarea = document.getElementById('description');
        const description_charCount = document.getElementById('charCountDescription');
        const description_maxLength = description_textarea.getAttribute('maxlength');
        const description_currentLength = description_textarea.value.length;
        description_charCount.textContent = `${description_maxLength - description_currentLength} characters remaining.`;
    }

    function deleteCollection(collectionId) {
        if (confirm("Are you sure you want to delete this collection?")) {
            const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

            fetch('/user/collection/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    [csrfHeader]: csrfToken
                },
                body: new URLSearchParams({'collectionId': collectionId})
            }).then(response => {
                if (response.ok) {
                    window.location.reload(); // Reload the page to reflect changes
                } else {
                    alert('Failed to delete collection.');
                }
            });
        }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>
</html>